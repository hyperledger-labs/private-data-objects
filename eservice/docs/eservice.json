{
    "$schema": "http://json-schema.org/schema#",
    "title": "PDO Contract Enclave Service Requests",
    "id": "http://tradenet.org/pdo/eservice/requests#",
    "definitions": {
        "ContractEnclaveServiceRequest": {
            "id": "#ContractEnclaveServiceRequest",
            "description": "General schema for requests to the PDO contract enclave service",
            "type": "object",
            "properties": {
                "request": {
                    "description": "the request to process",
                    "type": "object",
                    "required": true,
                    "oneOf": [
                        {
                            "$ref": "#UpdateContractRequest"
                        },
                        {
                            "$ref": "#EnclaveDataRequest"
                        },
                        {
                            "$ref": "#VerifySecretRequest"
                        }
                    ]
                }
            }
        },
        "UpdateContractRequest": {
            "id": "#UpdateContractRequest",
            "description": "a request to apply a method to an existing instance of a contract",
            "type": "object",
            "properties": {
                "operation": {
                    "description": "field describing the type of the request",
                    "type": "string",
                    "enum": [
                        "UpdateContractRequest"
                    ],
                    "required": true
                },
                "encrypted_session_key": {
                    "description": "an AES key encrypted with enclave RSA key",
                    "type": "string",
                    "minLength": 344,
                    "maxLength": 344,
                    "format": "base64 urlsafe encoded, no padding",
                    "required": true
                },
                "encrypted_request": {
                    "description": "contract request encrypted with the AES session key",
                    "type": "string",
                    "minLength": 0,
                    "maxLength": 0,
                    "format": "base64 urlsafe encoded, no padding",
                    "required": true
                }
            }
        },
        "UpdateContractResponse": {
            "id": "#UpdateContractResponse",
            "description": "a response for an UpdateContractRequest",
            "type": "object",
            "properties": {
                "result": {
                    "description": "response to the update request, encrypted with the sessions key",
                    "type": "string",
                    "minLength": 0,
                    "maxLength": 0,
                    "format": "base64 urlsafe encoded, no padding",
                    "required": true
                }
            }
        },
        "VerifySecretRequest": {
            "id": "#VerifySecretRequest",
            "description": "request to verify secrets generated by the provisioning services",
            "type": "object",
            "properties": {
                "operation": {
                    "description": "field describing the type of the request",
                    "type": "string",
                    "enum": [
                        "verifySecretRequest"
                    ],
                    "required": true
                },
                "contract_id": {
                    "description": "unique identifier for the contract",
                    "$ref": "#/pdo/basetypes/contractid",
                    "required": true
                },
                "creator_id": {
                    "description": "identifier for the creator of the contract",
                    "$ref": "#/pdo/basetypes/transactorid",
                    "required": true
                },
                "Secrets": {
                    "description": "List of dependent contract commits",
                    "type": "array",
                    "minItems": 1,
                    "uniqueItems": true,
                    "items": {
                        "type": "object",
                        "properties": {
                            "pspk": {
                                "description": "public key of the provisioning service that created the secret",
                                "$ref": "#/pdo/basetypes/ecdsapublickey",
                                "required": true
                            },
                            "encrypted_secret": {
                                "description": "secret and provisioning service signature encrypted with the enclave's RSA key",
                                "$ref": "#/pdo/basetypes/contract-secret",
                                "required": true
                            }
                        }
                    }
                }
            }
        },
        "VerifySecretResponse": {
            "id": "#VerifySecretResponse",
            "description": "response to the verify secrets request",
            "type": "object",
            "properties": {
                "encrypted_state_encryption_key": {
                    "description": "the encrypted secret created for use by an enclave for this contract instance",
                    "$ref": "#/pdo/basetypes/state-encryption-key",
                    "required": true
                },
                "signature": {
                    "description": "signature of the request/response",
                    "$ref": "#/pdo/basetypes/signature",
                    "required": true
                }
            }
        },
        "EnclaveDataRequest": {
            "id": "#EnclaveDataRequest",
            "description": "request information about the enclave for registration in the ledger",
            "type": "object",
            "properties": {
                "operation": {
                    "description": "field describing the type of the request",
                    "type": "string",
                    "enum": [
                        "EnclaveDataRequest"
                    ],
                    "required": true
                }
            }
        },
        "EnclaveDataResponse": {
            "id": "#EnclaveDataResponse",
            "description": "response to the sign up request message",
            "type": "object",
            "properties": {
                "verifying_key": {
                    "description": "ECDSA key used by the enclave to sign results",
                    "$ref": "#/pdo/basetypes/ecdsa-public-key",
                    "required": true
                },
                "encryption_key": {
                    "description": "RSA key used to encrypt secrets passed to the enclave",
                    "$ref": "#/pdo/basetypes/rsa-public-key",
                    "required": true
                }
            }
        }
    }
}